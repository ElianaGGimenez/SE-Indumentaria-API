<h2>{{product.title}}</h2>
<img src="{{product.image}}" alt="{{product.title}}" style="max-width:300px" />
<p>Precio: ${{product.price}}</p>
<p>Categoria: {{product.category}}</p>
<p>Stock: {{product.stock}}</p>

<form id="add-to-cart" action="/api/carts" method="post">
  <button id="btn-add">Agregar al carrito</button>
</form>

<script>
  document.getElementById("btn-add").addEventListener("click", async (e) => {
    e.preventDefault();
    try {
      const createRes = await fetch('/api/carts', { method: 'POST' });
      const cart = await createRes.json();
      const cid = cart.payload._id;
      const pid = "{{product._id}}";
      await fetch(`/api/carts/${cid}/product/${pid}`, { method: 'POST' });
      alert('Producto agregado al carrito ' + cid);
      window.location = `/carts/${cid}`;
    } catch (err) {
      console.error(err);
      alert('Error agregando al carrito');
    }
  });
</script>
